## ğŸ“‹ é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡æ¡£

ä»¥ä¸‹æ˜¯å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ–°sessionä¸­ä½¿ç”¨è¿™äº›å†…å®¹ç»§ç»­å·¥ä½œï¼š

---

## âœ… å·²å®Œæˆå·¥ä½œ

### Phase 1: é¡¹ç›®æ­å»º
- [x] Gitä»“åº“åˆå§‹åŒ–ï¼ˆ.gitignoreï¼‰
- [x] Tauri v2 + React + TypeScripté¡¹ç›®åˆ›å»º
- [x] ä¾èµ–é…ç½®ï¼ˆpackage.jsonï¼‰

### Phase 2: Pythonæ¨ç†æœåŠ¡
- [x] è™šæ‹Ÿç¯å¢ƒåˆ›å»ºï¼ˆinference/venvï¼‰
- [x] ä¾èµ–å®‰è£…ï¼ˆwebsockets, transformers, torch, numpy, librosaï¼‰
- [x] ASR WebSocketæœåŠ¡ï¼ˆasr_service.pyï¼‰
- [x] TTS WebSocketæœåŠ¡ï¼ˆtts_service.pyï¼‰
- [x] ç¼–æ’è„šæœ¬ï¼ˆrun_inference.pyï¼‰
- [x] æµ‹è¯•è„šæœ¬ï¼ˆtest_asr.py, test_tts.pyï¼‰
- [x] CUDAç¯å¢ƒæ­å»ºï¼ˆVisual C++ Redistributable + PyTorch 2.4.0+cu124ï¼‰
- [x] æ¨¡å‹é…ç½®ï¼ˆmodels.yamlï¼‰
- [x] ASRæœåŠ¡CUDAä¼˜åŒ–ï¼ˆdeviceæ£€æµ‹ã€FP16ã€KV cacheï¼‰
- [x] TTSæœåŠ¡CUDAä¼˜åŒ–ï¼ˆdeviceæ£€æµ‹ã€FP16ã€base/customæ¨¡å‹ï¼‰
- [x] è¯­éŸ³ç®¡ç†å·¥å…·ï¼ˆvoice_manager.pyï¼‰
- [x] ç‹¬ç«‹è¿è¡Œè„šæœ¬ï¼ˆrun_asr.pyã€run_tts.pyã€start_both.batï¼‰
- [x] TTSç‹¬ç«‹ç¯å¢ƒï¼ˆvenv-ttsï¼Œtransformers 4.57.x + qwen-ttsï¼‰
- [x] WebSocketé€šä¿¡ä¿®å¤ï¼ˆè¶…æ—¶å¤„ç†ã€bytes.tobytes()é”™è¯¯ï¼‰
- [x] éŸ³é¢‘ç”ŸæˆéªŒè¯ï¼ˆtest_diagnose.pyã€test_tts.pyé€šè¿‡ï¼‰

### Phase 3: Ruståç«¯ç»„ä»¶
- [x] ä¾èµ–é…ç½®ï¼ˆtokio, tokio-tungstenite, serde, async-openai, cpal, anyhowï¼‰
- [x] éŸ³é¢‘æ•è·ï¼ˆaudio/capture.rsï¼‰- åŒ…å«ASR WebSocketé›†æˆ
- [x] WebSocketå®¢æˆ·ç«¯ï¼ˆinference/client.rsï¼‰
- [x] éŸ³é¢‘æ’­æ”¾ï¼ˆaudio/playback.rsï¼‰- åŒ…å«çŠ¶æ€äº‹ä»¶å‘å°„
- [x] å¯¹è¯çŠ¶æ€æœºï¼ˆconversation/state.rsï¼‰
- [x] LLMæµå¼å®¢æˆ·ç«¯ï¼ˆllm/client.rsï¼‰- åŒ…å«TTSé›†æˆ
- [x] Tauriå‘½ä»¤é›†æˆ

### Phase 4: Reactå‰ç«¯
- [x] ZustandçŠ¶æ€ç®¡ç†å®‰è£…
- [x] VoiceAssistantç»„ä»¶å®ç°
- [x] Tauriäº‹ä»¶/å‘½ä»¤é›†æˆ
- [x] äº‹ä»¶ç›‘å¬æ›´æ–°ï¼ˆvoice_assistant: å‰ç¼€å‘½åç©ºé—´ï¼‰

### Phase 5: å‰åç«¯é›†æˆ âœ¨ NEW
- [x] ASR WebSocketé›†æˆï¼ˆcapture.rs â†’ ws://127.0.0.1:8765ï¼‰
- [x] TTS WebSocketé›†æˆï¼ˆllm/client.rs â†’ ws://127.0.0.1:8766ï¼‰
- [x] éŸ³é¢‘æµå¼ä¼ è¾“ï¼ˆPCM16 æ ¼å¼ï¼‰
- [x] çŠ¶æ€æœºè‡ªåŠ¨è½¬æ¢
- [x] ç¼–è¯‘é”™è¯¯ä¿®å¤ï¼ˆasync_openai APIã€cpal Streamç”Ÿå‘½å‘¨æœŸï¼‰

### Phase 6: æ–‡æ¡£
- [x] README.mdåˆ›å»ºï¼ˆæ¶æ„ã€å®‰è£…ã€ä½¿ç”¨è¯´æ˜ï¼‰
- [x] .gitignoreæ›´æ–°

---

## ğŸ“‚ å½“å‰æ–‡ä»¶ç»“æ„

```
sisyphus/
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ PROJECT_CURRENT_STATUS.md        # æœ¬æ–‡æ¡£ï¼ˆå·¥ä½œçŠ¶æ€è¿½è¸ªï¼‰
â”œâ”€â”€ README.md                       # ä¸»æ–‡æ¡£
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ MODELS.md                 # æ¨¡å‹é…ç½®æ–‡æ¡£
â”œâ”€â”€ inference/
â”‚   â”œâ”€â”€ venv/                      # ASRè™šæ‹Ÿç¯å¢ƒï¼ˆtransformers 5.x + torch 2.4.0+cu124ï¼‰
â”‚   â”œâ”€â”€ venv-tts/                  # TTSè™šæ‹Ÿç¯å¢ƒï¼ˆtransformers 4.57.x + qwen-ttsï¼‰
â”‚   â”œâ”€â”€ requirements.txt              # ASRä¾èµ–
â”‚   â”œâ”€â”€ requirements-tts.txt          # TTSä¾èµ–
â”‚   â”œâ”€â”€ models.yaml                # æ¨¡å‹é…ç½®ï¼ˆASR: GLM-ASR-Nano-2512, TTS: Qwen3-TTS-12Hz-1.7B Base/CustomVoiceï¼‰
â”‚   â”œâ”€â”€ voices/                    # è¯­éŸ³å‚è€ƒç›®å½•
â”‚   â”œâ”€â”€ voice_manager.py           # è¯­éŸ³ç®¡ç†å·¥å…·
â”‚   â”œâ”€â”€ asr_service.py             # ASR WebSocketæœåŠ¡ï¼ˆCUDAä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ tts_service.py             # TTS WebSocketæœåŠ¡ï¼ˆCUDAä¼˜åŒ–ã€base/customæ”¯æŒï¼‰
â”‚   â”œâ”€â”€ run_asr.py                # ASRç‹¬ç«‹è¿è¡Œå…¥å£
â”‚   â”œâ”€â”€ run_tts.py                # TTSç‹¬ç«‹è¿è¡Œå…¥å£
â”‚   â”œâ”€â”€ start_both.bat            # æ‰¹é‡å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ test_asr.py              # ASRæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_tts.py              # TTSæµ‹è¯•è„šæœ¬ï¼ˆå·²ä¿®å¤è¶…æ—¶é—®é¢˜ï¼‰
â”‚   â”œâ”€â”€ test_diagnose.py         # TTSè¯Šæ–­è„šæœ¬
â”‚   â””â”€â”€ run_inference.py         # ç¼–æ’è„šæœ¬ï¼ˆåŸå§‹ï¼Œå·²è¢«ç‹¬ç«‹è„šæœ¬æ›¿ä»£ï¼‰
â”œâ”€â”€ src-tauri/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â”‚   â”œâ”€â”€ capture.rs       # éŸ³é¢‘æ•è· + ASR WebSocket
â”‚   â”‚   â”‚   â”œâ”€â”€ playback.rs      # éŸ³é¢‘æ’­æ”¾ + çŠ¶æ€äº‹ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â”‚   â”œâ”€â”€ state.rs
â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ inference/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.rs
â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.rs        # LLM + TTSé›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â””â”€â”€ tauri.conf.json
â””â”€â”€ src/
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ VoiceAssistant.tsx
    â”œâ”€â”€ App.tsx
    â”œâ”€â”€ App.css
    â”œâ”€â”€ main.tsx
    â””â”€â”€ vite-env.d.ts
```

---

## ğŸ”„ æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Tauri Application                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    PCM16    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    JSON     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Microphoneâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ capture.rsâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ ASR WS  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚:8765    â”‚  â”‚
â”‚                                                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚       â”‚
â”‚                                                          â–¼       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         transcript    â”‚
â”‚                           â”‚ Frontend     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                           â”‚ (React)      â”‚                       â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                  â”‚                               â”‚
â”‚                            user message                          â”‚
â”‚                                  â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    PCM16    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   text     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Speaker  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤playback.rsâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ TTS WS  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚:8766    â”‚   â”‚
â”‚                                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚        â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    text   â”‚        â”‚
â”‚                                â”‚llm/client â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                â”‚  (OpenAI) â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—

### å‰ç½®æ¡ä»¶
1. **Python æ¨ç†æœåŠ¡è¿è¡Œä¸­**
   ```bash
   # ç»ˆç«¯1ï¼šå¯åŠ¨ASRæœåŠ¡
   cd inference
   venv\Scripts\python run_asr.py

   # ç»ˆç«¯2ï¼šå¯åŠ¨TTSæœåŠ¡
   cd inference
   venv-tts\Scripts\python run_tts.py
   ```

2. **ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   # è®¾ç½® OpenAI API Key
   set OPENAI_API_KEY=your_api_key_here
   # æˆ–
   set LLM_API_KEY=your_api_key_here
   ```

### è¿è¡Œæµ‹è¯•
```bash
# ç»ˆç«¯3ï¼šå¯åŠ¨Tauriåº”ç”¨
npm run tauri dev
```

### æµ‹è¯•æµç¨‹
1. ç‚¹å‡»å½•éŸ³æŒ‰é’®å¼€å§‹å½•éŸ³
2. è¯´è¯ï¼ˆASRä¼šå®æ—¶è½¬å½•ï¼‰
3. ç‚¹å‡»åœæ­¢æŒ‰é’®
4. è§‚å¯Ÿï¼š
   - å‰ç«¯æ˜¾ç¤ºè½¬å½•æ–‡æœ¬
   - LLMç”Ÿæˆå“åº”
   - TTSåˆæˆè¯­éŸ³
   - æ‰¬å£°å™¨æ’­æ”¾å“åº”

---

## ğŸ“Š ç»Ÿä¸€äº‹ä»¶å‘½åè§„èŒƒ

| äº‹ä»¶åç§° | ç”¨é€” | æ•°æ®ç»“æ„ |
|---------|------|---------|
| `voice_assistant:state_changed` | çŠ¶æ€å˜åŒ– | `{ state: "Idle" \| "Listening" \| "FinalizingASR" \| "Thinking" \| "Speaking" }` |
| `voice_assistant:user_transcript` | ASR è½¬å½• | `{ partial, final_text, confidence }` |
| `voice_assistant:assistant_response` | LLM å“åº” | `{ content, is_complete }` |
| `voice_assistant:audio_level` | éŸ³é‡æŒ‡ç¤º | `{ level }` |
| `voice_assistant:vad_status` | VAD çŠ¶æ€ | `{ status: "speech_start" \| "speech_end" }` |
| `voice_assistant:playback_started` | æ’­æ”¾å¼€å§‹ | `()` |
| `voice_assistant:playback_ended` | æ’­æ”¾ç»“æŸ | `()` |
| `voice_assistant:error` | é”™è¯¯é€šçŸ¥ | `{ code, message }` |

---

## ğŸ’¡ å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šTransformersç‰ˆæœ¬å†²çª
**ç—‡çŠ¶**ï¼šGLM-ASRéœ€è¦transformers 5.xï¼ŒQwen3-TTSéœ€è¦4.57.x
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç‹¬ç«‹è™šæ‹Ÿç¯å¢ƒ
- venv: transformers 5.xï¼ˆç”¨äºASRï¼‰
- venv-tts: transformers 4.57.xï¼ˆç”¨äºTTSï¼‰

### é—®é¢˜2ï¼šcpal::Stream ä¸æ˜¯ Send
**ç—‡çŠ¶**ï¼šæ— æ³•å°† Stream æ”¾å…¥ Arc<Mutex<>>
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Box::leak ä¿æŒ Stream å­˜æ´»ï¼Œé€šè¿‡ AtomicBool æ§åˆ¶çŠ¶æ€

### é—®é¢˜3ï¼šasync_openai 0.14 API
**ç—‡çŠ¶**ï¼šç±»å‹ä¸å­˜åœ¨ï¼ˆChatCompletionRequestUserMessageArgsç­‰ï¼‰
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£ç¡®çš„ ChatCompletionRequestMessageArgs + Role æ„å»ºæ¶ˆæ¯

### é—®é¢˜4ï¼šMutexGuard è·¨ await ç‚¹
**ç—‡çŠ¶**ï¼šfuture is not Send
**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ await å‰é‡Šæ”¾é”ï¼Œclone éœ€è¦çš„æ•°æ®

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ä¼˜å…ˆçº§ 1ï¼šç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯
- [ ] éªŒè¯ ASR â†’ å‰ç«¯ è½¬å½•æ˜¾ç¤º
- [ ] éªŒè¯ LLM â†’ TTS â†’ æ’­æ”¾ å®Œæ•´æµç¨‹
- [ ] æµ‹é‡ç«¯åˆ°ç«¯å»¶è¿Ÿ
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

### ä¼˜å…ˆçº§ 2ï¼šDockeråŒ–éƒ¨ç½²
- [ ] åˆ›å»ºDockerfileï¼ˆASRæœåŠ¡ï¼‰
- [ ] åˆ›å»ºDockerfileï¼ˆTTSæœåŠ¡ï¼‰
- [ ] åˆ›å»ºdocker-compose.yml

### ä¼˜å…ˆçº§ 3ï¼šæ€§èƒ½ä¼˜åŒ–
- [ ] å®‰è£…flash-attnï¼ˆæå‡TTSæ¨ç†é€Ÿåº¦ï¼‰
- [ ] æ‰¹é‡æ¨ç†ä¼˜åŒ–

### ä¼˜å…ˆçº§ 4ï¼šé”™è¯¯å¤„ç†
- [ ] WebSocketæ–­çº¿é‡è¿
- [ ] æ¨¡å‹åŠ è½½å¤±è´¥é‡è¯•
- [ ] GPUå†…å­˜ä¸è¶³é™çº§

---

## ğŸ“ æ–°SessionæŒ‡ä»¤

åœ¨æ–°sessionä¸­ï¼Œè¯·å‘Šè¯‰AIï¼š

**"è¯»å–F:\GitRepository\sisyphus\PROJECT_CURRENT_STATUS.mdï¼Œç„¶åç»§ç»­å·¥ä½œ"**

---

## ğŸ“Š å·¥ä½œæ—¥å¿—æ‘˜è¦

### 2025-02-01ï¼ˆSession 2ï¼‰
1. **ç¼–è¯‘é”™è¯¯ä¿®å¤**
   - ä¿®å¤ playback.rs å¯å˜æ€§é—®é¢˜ï¼ˆé™æ€å˜é‡ + OnceLockï¼‰
   - ä¿®å¤ capture.rs cpal API é—®é¢˜ï¼ˆBox::leakï¼‰
   - ä¿®å¤ llm/client.rs async_openai APIï¼ˆæ­£ç¡®çš„æ¶ˆæ¯æ„å»ºï¼‰
   - ä¿®å¤ inference/client.rs è¿”å›ç±»å‹

2. **ASR é›†æˆå®ç°**
   - capture.rs è¿æ¥ ws://127.0.0.1:8765
   - éŸ³é¢‘æ•è·å›è°ƒå‘é€ PCM16 å¸§
   - æ¥æ”¶ ASR ç»“æœå¹¶å‘å°„äº‹ä»¶

3. **TTS é›†æˆå®ç°**
   - llm/client.rs è¿æ¥ ws://127.0.0.1:8766
   - LLM å“åº”å—å‘é€åˆ° TTS
   - æ¥æ”¶éŸ³é¢‘å¸§å¹¶é˜Ÿåˆ—æ’­æ”¾

4. **çŠ¶æ€æœºåè°ƒ**
   - è‡ªåŠ¨çŠ¶æ€è½¬æ¢ï¼ˆIdle â†’ Listening â†’ FinalizingASR â†’ Thinking â†’ Speaking â†’ Idleï¼‰
   - playback.rs æ’­æ”¾å®Œæˆäº‹ä»¶

5. **å‰ç«¯äº‹ä»¶æ›´æ–°**
   - ç»Ÿä¸€ voice_assistant: å‰ç¼€
   - æ·»åŠ éŸ³é‡å¯è§†åŒ–
